# Домашнее задание № 1

## 1. Тема и целевая аудитория

### 1.1. Тема 
Twitch [[1](https://ru.wikipedia.org/wiki/Twitch)] - видеостриминговый сервис, специализирующийся на тематике компьютерных игр, в том числе трансляциях геймплея и киберспортивных турниров. Видео на платформе Twitch можно просматривать как в реальном времени, так и по запросу. Twitch принадлежит Twitch Interactive — дочерней компании Amazon.

### 1.2 . Целевая аудитория 
В августе количество поситителей превысило отметку в 1.2 миллиарда посетителей в месяц, это примерно 40 миллионов посетителей в день. [[2](https://www.similarweb.com/ru/website/twitch.tv/#traffic)]
Целевая аудитория согласно [[тык](https://www.similarweb.com/ru/website/twitch.tv/#geography)] по количеству поситителей:
1. Соединённые штаты - 20.48%
2. Германия - 6.54%
3. Республика Корея - 5.09%
4. Россия - 4.70%
5. Франция - 4.27%

### 1.3. MVP
* Просмотр онлайн трансляций
* Чат закреплённый к трансляции
* Платная и бесплатная подписка на канал
* Авторизация пользователей

## 2. Расчёт нагрузки

### 2.1. Продуктовые метрики 
* Месячная аудитория - 1.2 млрд [[2](https://www.similarweb.com/ru/website/twitch.tv/#traffic)]
* Суточная аудитория - 40 млн [[2](https://www.similarweb.com/ru/website/twitch.tv/#traffic)]
* Среднее время, проведенное на веб-сайте - 00:08:51 [[2](https://www.similarweb.com/ru/website/twitch.tv/#traffic)]
* Среднее количество страниц за визит - 4.48 [[2](https://www.similarweb.com/ru/website/twitch.tv/#traffic)]

Согласно [статистике просмотров](https://streamscharts.com/overview) за прошлый месяц среднее количество просмотров в день было около 2.6 миллионов зрителей.

Для того чтобы понять сколько сообщений в чат отправляют пользователи, обратимся к ресурсу, на котором указано [среднее количество сообщений в секунду](https://stats.streamelements.com/). На момент просмотра статистики среднее значение было 720 сообщений в секунду => 720 * 60 * 60 * 24 = 62.2 млн в день.

Общей информации о количестве всех подписок на все каналы в открытом доступе нет. Поэтому я проанализирвал [среднее количество просмотров](https://streamscharts.com/subscribers) на популярных каналах и среднее количество подписок на их каналы в месяц. Исходя их этого можно предположить, что примерно 6.34% от живых зрителей подписываются на канал => 0.0634 * 2.6 млн в день = 0.165 млн в день.

Говорить о количестве запросов на авторизацию - тяжело, поэтому предположим, что 60% всех ежедневных пользователей смотрящих трансялции проходит запросы авторизации => 0.6 * 2.6 млн = 1.3 млн. в день. 

**Среднее количество действий пользователей**
Тип запроса                | Среднее количество (Измеряем в млн/день)
-------------------------- | -----------------------------
Просмотр онлайн трансляции |  2.6
Отправка сообщения в чат   |  62.2 
Подписка на стримера       |  0.165
Авторизация                |  1.3

### 2.2. Технические метрики
#### 2.2.1. Сетевой трафик
##### 2.2.1.1. Входящий трафик
Ежедневно на платформе  [происходит стрмминг](https://twitchtracker.com/statistics/stream-time) 2 083 003 часов.
На twitch, можно выбрать качество просмотра трансялции, возьмём среднее из [источника](https://help.twitch.tv/s/article/broadcast-guidelines?language=ru): ```720p 60fps = 4500 кбит/с```
```
2 083 003 * 60 * 60 с * 4500 кбит/с =  3750000 Гб в сутки 
```
Из этого следует, что 3750000 - входящий трафик в сутки, который тратится на создание трансляций.

Для того чтобы расчитать нагрузку чата, возьмём вес одного символа 16 бит, а средний размер сообщения: 10 символов. Тогда 160 бит - вес в среднем одного сообщения. ``` 160 * 62 200 000 = 1,24 Гб в сутки```

Сделаем ещё одно допущение: пусть на один запрос авторизации будет весом 0.5 кб памяти. Тогда в сутки будет обрабатываться 0.26 гб. 

Информацие о подписках на стримера можно пренебречь, т.к. эти данные существенно меньше, чем входящий трафик на другие категории.

##### 2.2.1.2. Исходящий трафик
Средняя продолжительность нахождения на платформе равна 00:08:51 (531 секунда) в сутки как уже говорилось выше. Количество посетителей сайта 40 млн в день. Далеко не каждый из этих пользовтаелей проводит своё время за просмотром трансляций, будем считать, что процент смотрящих трансляции людей равен 70% от 40 млн.
```
531 c * 4500 кбит/с * 40 000 000 млн/сутки  * 0.7 = 7 656 250 Гб
```
Выходит, что 7 656 250 Гб - исходящий трафик в сутки

Исходящий трафик чата - просмотр его истории. Согласно [9](https://twitchtracker.com/statistics/active-streamers), получаем около 120 активных участников чата  в среднем. Таким образом каждый зритель трансляции создаёт трафик для просмотра чата, в которой ведут активность ~120 человек => активность одного человека, влечёт за собой 120-кратную активность со стороны других участников чата.
```
1,24 * 120 = 148.8 Гб в сутки
```
Выходит, что : исходящий трафик для чата приблизительно равен 150 Гб в сутки
#### 2.2.2. RPS
Просмотр онлайн трансляций(при обновлении счётчика 1 раз в минуту)
```
90 000 / 60 = 1500 запр. в сек.
```
Отправка сообщений согласно [[5](https://stats.streamelements.com/)] равна ```720 запр. в сек.```
Подписка на стримера
```
165 000 / 24 / 60 / 60 = 2 запр. в сек.
```
Авторизация
```
1 300 000 / 24 / 60 / 60 = 15 запр. в сек.
```

Тип запроса                | RPS
-------------------------- | -----------------------------
Просмотр онлайн трансляции |  1500
Отправка сообщения в чат   |  720 
Подписка на стримера       |  2
Авторизация                |  15
## 3. Источники
1. https://ru.wikipedia.org/wiki/Twitch
2. https://www.similarweb.com/ru/website/twitch.tv/#traffic
3. https://www.similarweb.com/ru/website/twitch.tv/#geography
4. https://streamscharts.com/overview
5. https://stats.streamelements.com/
6. https://streamscharts.com/subscribers
7. https://twitchtracker.com/statistics/stream-time 
8. https://help.twitch.tv/s/article/broadcast-guidelines?language=ru
9. https://twitchtracker.com/statistics/active-streamers
